<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">




<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

  <meta name="author" content="pidi">



  <meta name="description" content="PIDI的个人博客">


  <meta name="keywords" content="pidi,运维，博客，IT男，匹敌">


<title>生产RDS时时同步到自建mysql8.0 | PiDi</title>



<link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/nprogress/nprogress.css">



<script src="/lib/jquery.min.js"></script>


<script src="/lib/iconify-icon.min.js"></script>


<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<script>
  tailwind.config = {
    darkMode: "class",
  };
</script>


<script src="/lib/nprogress/nprogress.js"></script>

<script>
  $(document).ready(() => {
    NProgress.configure({
      showSpinner: false,
    });
    NProgress.start();
    $("#nprogress .bar").css({
      background: "#de7441",
    });
    $("#nprogress .peg").css({
      "box-shadow": "0 0 2px #de7441, 0 0 4px #de7441",
    });
    $("#nprogress .spinner-icon").css({
      "border-top-color": "#de7441",
      "border-left-color": "#de7441",
    });
    setTimeout(function () {
      NProgress.done();
      $(".fade").removeClass("out");
    }, 800);
  });
</script>

<script>
  (function () {
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;
    const setting = localStorage.getItem("hexo-color-scheme") || "auto";
    if (setting === "dark" || (prefersDark && setting !== "light"))
      document.documentElement.classList.toggle("dark", true);
    let isDark = document.documentElement.classList.contains("dark");
  })();

  $(document).ready(function () {
    // init icon
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;
    const isDark = document.documentElement.classList.contains("dark");
    $("#theme-icon").attr("icon", isDark ? "ri:moon-line" : "ri:sun-line");

    function toggleGiscusTheme() {
      const isDark = document.documentElement.classList.contains("dark");
      const giscusFrame = document.querySelector("iframe.giscus-frame");
      if (giscusFrame) {
        giscusFrame.contentWindow.postMessage(
          {
            giscus: {
              setConfig: {
                theme: isDark ? "dark" : "light",
              },
            },
          },
          "https://giscus.app"
        );
      }
    }


    // toggle dark mode
    function toggleDark() {
      let isDark = document.documentElement.classList.contains("dark");
      const setting = localStorage.getItem("hexo-color-scheme") || "auto";
      isDark = !isDark;
      document.documentElement.classList.toggle("dark", isDark);
      $("#theme-icon").attr("icon", isDark ? "ri:moon-line" : "ri:sun-line");
      if (prefersDark === isDark) {
        localStorage.setItem("hexo-color-scheme", "auto");
      } else {
        localStorage.setItem("hexo-color-scheme", isDark ? "dark" : "light");
      }
      toggleGiscusTheme();
    }
    $("#toggle-dark").click(toggleDark);

    // listen dark mode change
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        const setting = localStorage.getItem("hexo-color-scheme") || "auto";
        if (setting === "auto") {
          document.documentElement.classList.toggle("dark", e.matches);
          $("#theme-icon").attr(
            "icon",
            e.matches ? "ri:moon-line" : "ri:sun-line"
          );
          toggleGiscusTheme();
        }
      });
  });
</script>




<meta name="generator" content="Hexo 6.3.0"></head>
<body class="font-sans bg-white dark:bg-zinc-900 text-gray-700 dark:text-gray-200 relative">
  <header class="fixed w-full px-5 py-1 z-10 backdrop-blur-xl backdrop-saturate-150 border-b border-black/5">
  <div class="max-auto">
    <nav class="flex items-center text-base">
      <a href="/" class="group">
        <h2 class="font-medium tracking-tighterp text-l p-2">
          <img class="w-5 mr-2 inline-block transition-transform group-hover:rotate-[30deg]" id="logo" src="/images/logo.svg" alt="PiDi" />
          PiDi
        </h2>
      </a>
      <div id="header-title" class="opacity-0 md:ml-2 md:mt-[0.1rem] text-xs font-medium whitespace-nowrap overflow-hidden overflow-ellipsis">
        生产RDS时时同步到自建mysql8.0
      </div>
      <div class="flex-1"></div>
      <div class="flex items-center gap-3">
        
          <a class="hidden sm:flex" href="/archives">Posts</a>
        
          <a class="hidden sm:flex" href="/tags">tags</a>
        
          <a class="hidden sm:flex" href="/categories/%7C%7C%20th">categories</a>
        
          <a class="hidden sm:flex" href="/archives/">archives</a>
        
        
          
            <a class="w-5 h-5 hidden sm:flex" title="Github" target="_blank" rel="noopener" href="https://github.com/ablewong">
              <iconify-icon width="20" icon="ri:github-line"></iconify-icon>
            </a>
          
        
        <a class="w-5 h-5 hidden sm:flex" title="Github" href="rss2.xml">
          <iconify-icon width="20" icon="ri:rss-line"></iconify-icon>
        </a>
        <a class="w-5 h-5" title="toggle theme" id="toggle-dark">
          <iconify-icon width="20" icon="" id="theme-icon"></iconify-icon>
        </a>
      </div>
      <div class="flex items-center justify-center gap-3 ml-3 sm:hidden">
        <span class="w-5 h-5" aria-hidden="true" role="img" id="open-menu">
          <iconify-icon width="20" icon="carbon:menu" ></iconify-icon>
        </span>
        <span class="w-5 h-5 hidden" aria-hidden="true" role="img" id="close-menu">
          <iconify-icon  width="20" icon="carbon:close" ></iconify-icon>
        </span>
      </div>
    </nav>
  </div>
</header>
<div id="menu-panel" class="h-0 overflow-hidden sm:hidden fixed left-0 right-0 top-12 bottom-0 z-10">
  <div id="menu-content" class="relative z-20 bg-white/80 px-6 sm:px-8 py-2 backdrop-blur-xl -translate-y-full transition-transform duration-300">
    <ul class="nav flex flex-col sm:flex-row text-sm font-medium">
      
        <li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main">
          <a href="/archives" class="flex h-12 sm:h-auto items-center">Posts</a>
        </li>
      
        <li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main">
          <a href="/tags" class="flex h-12 sm:h-auto items-center">tags</a>
        </li>
      
        <li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main">
          <a href="/categories/%7C%7C%20th" class="flex h-12 sm:h-auto items-center">categories</a>
        </li>
      
        <li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main">
          <a href="/archives/" class="flex h-12 sm:h-auto items-center">archives</a>
        </li>
      
    </ul>
  </div>
  <div class="mask bg-black/20 absolute inset-0"></div>
</div>

  <main class="pt-14">
    <!-- css -->

<link rel="stylesheet" href="/lib/fancybox/fancybox.min.css">


<link rel="stylesheet" href="/lib/tocbot/tocbot.min.css">

<!-- toc -->

  <!-- tocbot -->
<nav class="post-toc toc text-sm w-48 relative top-32 right-0 opacity-70 hidden lg:block" style="position: fixed !important;"></nav>


<section class="px-6 max-w-prose mx-auto md:px-0">
  <!-- header -->
  <header class="overflow-hidden pt-6 pb-6 md:pt-12">
    <div class="pt-4 md:pt-6">
      <h1 id="article-title" class="text-[2rem] font-bold leading-snug mb-4 md:mb-6 md:text-[2.6rem]">
        生产RDS时时同步到自建mysql8.0
      </h1>
      <div>
        <section class="flex items-center gap-3 text-sm">
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="carbon-calendar" ></iconify-icon>
            <time>2023-12-11</time>
          </span>
          <span class="text-gray-400">·</span>
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="ic:round-access-alarm" ></iconify-icon>
            <span>24 min</span>
          </span>
          <span class="text-gray-400">·</span>
          <span class="flex items-center gap-1">
            <iconify-icon width="18" icon="icon-park-outline:font-search" ></iconify-icon>
            <span>4.5k words</span>
          </span>
          
        </section>
      </div>
    </div>
  </header>
  <!-- content -->
  <article class="post-content prose m-auto slide-enter-content dark:prose-invert">
    <h1 id="生产RDS时时同步到自建mysql8-0"><a href="#生产RDS时时同步到自建mysql8-0" class="headerlink" title="生产RDS时时同步到自建mysql8.0"></a>生产RDS时时同步到自建mysql8.0</h1><h4 id="一、环境说明："><a href="#一、环境说明：" class="headerlink" title="一、环境说明："></a>一、环境说明：</h4><p>RDS版本： MySQL8.0;  小版本信息 rds_20220331 ; 实例规格 mysql.n2.large.2c</p>
<p>自建mysql版本：mysql  Ver 8.0.29 for Linux on x86_64 (MySQL Community Server - GPL)</p>
<p>自建mysql机器 OS:  Alibaba Cloud Linux 3</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://www.52codes.net/article/76699.html">http://www.52codes.net/article/76699.html</a></p>
<p>本想用xtraback，但Alibaba Cloud Linux装这个装不上，编译安装也是总报错ld未找到，但我执行ld命令没一点问题。后面放弃了。用mysqldump了</p>
<h4 id="二、搭建mysql-server8-0"><a href="#二、搭建mysql-server8-0" class="headerlink" title="二、搭建mysql-server8.0"></a>二、搭建mysql-server8.0</h4><h5 id="1、下载mysql的yum源，安装源。确认下有没有mariadb，需要卸载掉。"><a href="#1、下载mysql的yum源，安装源。确认下有没有mariadb，需要卸载掉。" class="headerlink" title="1、下载mysql的yum源，安装源。确认下有没有mariadb，需要卸载掉。"></a>1、下载mysql的yum源，安装源。确认下有没有mariadb，需要卸载掉。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-6.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum localinstall mysql80-community-release-el7-6.noarch.rpm</span><br><span class="line">sudo rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br></pre></td></tr></table></figure>

<h5 id="2、安装mysql和mysql-server"><a href="#2、安装mysql和mysql-server" class="headerlink" title="2、安装mysql和mysql-server"></a>2、安装mysql和mysql-server</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server mysql -y</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>

<h5 id="3、添加配置文件，修改存储位置，因为-data盘空间大，换到那去。"><a href="#3、添加配置文件，修改存储位置，因为-data盘空间大，换到那去。" class="headerlink" title="3、添加配置文件，修改存储位置，因为&#x2F;data盘空间大，换到那去。"></a>3、添加配置文件，修改存储位置，因为&#x2F;data盘空间大，换到那去。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">cat /var/logs/mysql.log	|grep password #找到密码</span><br><span class="line">mysql -uroot -p 	#登陆上去</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">ALTER USER USER() IDENTIFIED BY <span class="string">&#x27;9szZM%ymh$&#x27;</span>; 	<span class="comment">#更新下密码</span></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update mysql.user <span class="built_in">set</span> host=<span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;MyNewPass&#x27;</span>; <span class="comment">#上面已经改了，这里可不改了。</span></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">FLUSH PRIVILEGES;</span></span><br><span class="line">systemctl stop mysqld</span><br><span class="line">mv /var/lib/mysql /data/		#把目前的数据迁移到data盘。</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">datadir=/data/mysql				#改到data目录下，data盘空间大。</span><br><span class="line">binlog_format = row </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gtid_mode=on					<span class="comment">#这个可以先不开启，有可能启不来</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">enforce_gtid_consistency=on		<span class="comment">#这个可以先不开启，有可能启不来</span></span></span><br><span class="line">server-id = 1234567890			#这个ID随便改，只要不和RDS上重合。</span><br><span class="line"></span><br><span class="line">replicate-ignore-db = mysql			#下面几个是同步需要忽略的库</span><br><span class="line">replicate-ignore-db = sys </span><br><span class="line">replicate-ignore-db = information_schema</span><br><span class="line">replicate-ignore-db = performance_schema</span><br></pre></td></tr></table></figure>

<h5 id="4、配置数据库连接数"><a href="#4、配置数据库连接数" class="headerlink" title="4、配置数据库连接数"></a>4、配置数据库连接数</h5><p>默认连接数为150</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables like <span class="string">&#x27;%max_connections%&#x27;</span>;</span></span><br><span class="line">+------------------------+-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| max_connections        | 151   |</span><br><span class="line">| mysqlx_max_connections | 100   |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">set</span> global max_connections=10000;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>



<h5 id="5、重启mysqld-增加开机自启。"><a href="#5、重启mysqld-增加开机自启。" class="headerlink" title="5、重启mysqld,增加开机自启。"></a>5、重启mysqld,增加开机自启。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>



<h4 id="三、备份RDS数据-还原到自建mysql-不用dump全部数据库，也dump不出来"><a href="#三、备份RDS数据-还原到自建mysql-不用dump全部数据库，也dump不出来" class="headerlink" title="三、备份RDS数据, 还原到自建mysql. 不用dump全部数据库，也dump不出来."></a>三、备份RDS数据, 还原到自建mysql. 不用dump全部数据库，也dump不出来.</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com -uac_rdsadmin -p --databases wrp_aciot wrp_blade_cloud wrp_cangdan wrp_insurance wrp_nacos wrp_xxljob &gt; ./sqlalldb.sql</span><br><span class="line">du -sh sqlalldb.sql		#查看下是否有数据大小</span><br><span class="line">vim sqlalldb.sql		#vim看下</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; ./sqlalldb.sql</span><br></pre></td></tr></table></figure>



<h4 id="四、RDS上增加同步用户，给用户权限、"><a href="#四、RDS上增加同步用户，给用户权限、" class="headerlink" title="四、RDS上增加同步用户，给用户权限、"></a>四、RDS上增加同步用户，给用户权限、</h4><h5 id="添加用户到阿里云控制台增加。"><a href="#添加用户到阿里云控制台增加。" class="headerlink" title="添加用户到阿里云控制台增加。"></a>添加用户到阿里云控制台增加。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql -h rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com -u ac_rdsadmin -p</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;ac_repliuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;xeGy#T!Gwby&#x27;</span>;</span></span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;identified by &#x27;xeGy#T!B!Gwby&#x27;&#x27; at line 1</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;ac_rdsadmin&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span>               </span><br><span class="line">ERROR 1045 (28000): Access denied for user &#x27;ac_rdsadmin&#x27;@&#x27;%&#x27; (using password: YES)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;ac_rdsadmin&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;C!5%AYmZK&#x27;</span>;</span></span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;IDENTIFIED BY &#x27;C!5%fjjHaRrAYmZK&#x27;&#x27; at line 1</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;ac_repliuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span> with grant option;</span></span><br><span class="line">ERROR 1045 (28000): Access denied for user &#x27;ac_rdsadmin&#x27;@&#x27;%&#x27; (using password: YES)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show grants <span class="keyword">for</span> ac_rdsadmin@<span class="string">&#x27;%&#x27;</span> ;</span></span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants for ac_rdsadmin@%                                                                                                                                                                                                                                                                                              |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO `ac_rdsadmin`@`%` WITH GRANT OPTION |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON *.* TO <span class="string">&#x27;ac_repliuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span> with grant option;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>

<p><strong>PS:</strong></p>
<p>MYSQL8.0没有 GRANT ALL PRIVILEGES ON <em>.</em> TO ‘ac_repliuser‘@’%’ identified by ‘xeGy#T!B!Gwby’;  这写法了，一条命令做了三件事。</p>
<p>create user ‘user_select‘@’%’ identified by ‘nYa#YEpZ5R’;    # 创建用户</p>
<p>GRANT ALL PRIVILEGES ON <em>.</em> TO ‘ac_repliuser‘@’%’ with grant option;  #给权限, 这个才是正解。</p>
<p>但是RDS上ac_rdsadmin 特级用户也没有ALL PRIVILEGES权限了。 只能减少权限赋权给用户</p>
<p>GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON <em>.</em> TO ‘ac_repliuser‘@’%’ with grant option;</p>
<h4 id="五、配置自建mysql同步RDS"><a href="#五、配置自建mysql同步RDS" class="headerlink" title="五、配置自建mysql同步RDS"></a>五、配置自建mysql同步RDS</h4><h5 id="1、查看备份下面的文件GTID位置"><a href="#1、查看备份下面的文件GTID位置" class="headerlink" title="1、查看备份下面的文件GTID位置"></a>1、查看备份下面的文件GTID位置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim ./sqlalldb.sql		#搜索GTID</span><br><span class="line">SET @MYSQLDUMP_TEMP_LOG_BIN = @@SESSION.SQL_LOG_BIN;</span><br><span class="line">SET @@SESSION.SQL_LOG_BIN= 0;</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">-- GTID state at the beginning of the backup </span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">SET @@GLOBAL.GTID_PURGED=/*!80000 &#x27;+&#x27;*/ &#x27;8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-456487&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="2、配置同步-这里是连接自建mysql操作"><a href="#2、配置同步-这里是连接自建mysql操作" class="headerlink" title="2、配置同步,这里是连接自建mysql操作"></a>2、配置同步,这里是连接自建mysql操作</h5><p>注意用户名密码，和host不要朝抄。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p </span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to master_host = <span class="string">&#x27;rm-wz9037f14v61.mysql.rds.aliyuncs.com&#x27;</span>, master_port = 3306, master_user = <span class="string">&#x27;ac_repliuser&#x27;</span>, master_password=<span class="string">&#x27;xeGy#Twby&#x27;</span>, master_auto_position = 1;</span></span><br></pre></td></tr></table></figure>

<h5 id="3、重新设置slave"><a href="#3、重新设置slave" class="headerlink" title="3、重新设置slave"></a>3、重新设置slave</h5><p>上面的值位置去掉&#x2F;<em>!80000 ‘+’</em>&#x2F; </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">reset slave;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SET @@GLOBAL.GTID_PURGED=<span class="string">&#x27;8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1,</span></span></span><br><span class="line">    &#x27;&gt; 8f9990ee-ce09-11ec-963f-00163e18a3de:1-456487&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="4、开始同步"><a href="#4、开始同步" class="headerlink" title="4、开始同步"></a>4、开始同步</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>



<h4 id="六、检查同步状态"><a href="#六、检查同步状态" class="headerlink" title="六、检查同步状态"></a>六、检查同步状态</h4><h5 id="1、连接到RDS查看，这是主库show-master-status-G过几分钟查一下。Position应该会更新"><a href="#1、连接到RDS查看，这是主库show-master-status-G过几分钟查一下。Position应该会更新" class="headerlink" title="1、连接到RDS查看，这是主库show  master  status\G过几分钟查一下。Position应该会更新"></a>1、连接到RDS查看，这是主库show  <font color="red">master</font>  status\G过几分钟查一下。Position应该会更新</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql -h rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com -u ac_rdsadmin -p</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status\G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mysql-bin.000130</span><br><span class="line">         Position: 1714982</span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-457994</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status\G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mysql-bin.000130</span><br><span class="line">         Position: 1732779</span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-458032</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="2、连接到MYSQL查看-show-slave-status-G"><a href="#2、连接到MYSQL查看-show-slave-status-G" class="headerlink" title="2、连接到MYSQL查看. show   slave  status \G"></a>2、连接到MYSQL查看. show  <font color=red> slave</font>  status \G</h5><p>原则上只看Slave_IO_Running和Slave_SQL_Running是不是为yes就代表正常工作。读rds的日志点Read_Master_Log_Pos，Exec_Master_Log_Pos是执行点，这两个会慢慢更新变动。Executed_Gtid_Set是否和RDS那边的一致。过几分钟查一次。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status \G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for source to send event</span><br><span class="line">                  Master_Host: rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: ac_repliuser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000130</span><br><span class="line">          Read_Master_Log_Pos: 1671383</span><br><span class="line">               Relay_Log_File: monitoring-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 1159167</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000130</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: mysql,sys,information_schema,performance_schema</span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1671383</span><br><span class="line">              Relay_Log_Space: 1159562</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 21490876</span><br><span class="line">                  Master_UUID: 8f9990ee-ce09-11ec-963f-00163e18a3de</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 8f9990ee-ce09-11ec-963f-00163e18a3de:456488-457902</span><br><span class="line">            Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-457902</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">       Master_public_key_path: </span><br><span class="line">        Get_master_public_key: 0</span><br><span class="line">            Network_Namespace: </span><br><span class="line">1 row in set, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>PS:</p>
<p>–负责把主库bin日志(Master_Log)内容投递到从库的中继日志上(Relay_Log)</p>
<p>Slave_IO_Running:Yes</p>
<p>–负责把中继日志上的语句在从库上执行一遍</p>
<p>Slave_SQL_Running:Yes</p>
<p>–Yes：表示正常， No：表示异常</p>
<p>Slave_IO线程相对比较简单，一般不容易出错。如果显示为No，则有可能以下原因导致：</p>
<p>​    * 网络问题 </p>
<p> * 权限问题，例如在配置slave同步时因为slave访问master没有权限导致 </p>
<p> * master上的binlog文件误删或者其他问题导致的master库突然停止更新binlog日志。解决方案是找到同步的点和binlog文件，重新change master</p>
<p> 相对的Slave_SQL线程就比较容易出错。例如人为的在从库插入一条数据，造成的主从库不一致。但此时两个线程的状态仍然是正常的，主库插入数据时，到从库同步时，从库会出现主键重复的错误。此时Slave_SQL_Running的状态变为No </p>
<p> 而Last_SQL_Error, Last_SQL_Error_Timestamp会记录错误的原因和发生的时间 </p>
<p> Slave_SQL_Running线程报错之后，会停止后续的SQL执行，因为向后执行会导致错误修复的难度增加</p>
<p>修复错误</p>
<p>– 先停止slave</p>
<p>stop slave;</p>
<p>– 跳过执行语句数量</p>
<p>– 此时需要查看错误日志去修复报错信息</p>
<p>set global sql_slave_skip_counter&#x3D;1;</p>
<p>– 开始slave</p>
<p>start slave;</p>
<p>– 然后再检查一下 slave status</p>
<p>如何判断完全同步</p>
<p>* Master_Log_File 和 Relay_Master_Log_File 所指向的文件必须一致</p>
<p>* Relay_Log_Pos 和 Exec_Master_Log_Pos 位置也要一致才行</p>
<p>* Slave_SQL_Running_State: 显示为wait 中继日志的sql语句已经全部执行完毕</p>
<h5 id="3、到RDS数据库里给用户改个密码。看是否会同步。"><a href="#3、到RDS数据库里给用户改个密码。看是否会同步。" class="headerlink" title="3、到RDS数据库里给用户改个密码。看是否会同步。"></a>3、到RDS数据库里给用户改个密码。看是否会同步。</h5><p>未改密码之前的RDS：万正军密码加密值为10470c3b4b1fed12c3baac014be15fac67c6e815</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use wrp_blade_cloud</span></span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from blade_user <span class="built_in">where</span> name=<span class="string">&#x27;万正军&#x27;</span>;</span></span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| id                  | tenant_id | code | user_type | account | password                                 | name      | real_name | avatar | id_card            | email          | phone       | birthday            | sex  | role_id             | dept_id             | post_id | create_user         | create_dept         | create_time         | update_user         | update_time         | status | is_deleted | auth_status              | id_card_type | id_card_no | phone_status | modify_account_status | auth_manager_status                      |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| 1526153517495046146 | 000000    | NULL |      NULL | wzj     | 10470c3b4b1fed12c3baac014be15fac67c6e815 | 万正军    | 万正军    | NULL   | 421023198812012155 | wzj@pidi.com | 18938831403 | 1988-12-01 12:00:00 |    1 | 1504996292152147969 | 1526111745112317954 | NULL    | 1526123139970949121 | 1526111745112317954 | 2022-05-16 18:52:08 | 1526153517495046146 | 2022-05-16 18:56:24 |      1 |          0 | 0x01                     |            1 | NULL       | 1            | 1                     | 0x00                                     |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>自建mysql未改密码之前：万正军密码加密值为10470c3b4b1fed12c3baac014be15fac67c6e815</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use wrp_blade_cloud</span></span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from blade_user <span class="built_in">where</span> name=<span class="string">&#x27;万正军&#x27;</span>;</span></span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| id                  | tenant_id | code | user_type | account | password                                 | name      | real_name | avatar | id_card            | email          | phone       | birthday            | sex  | role_id             | dept_id             | post_id | create_user         | create_dept         | create_time         | update_user         | update_time         | status | is_deleted | auth_status              | id_card_type | id_card_no | phone_status | modify_account_status | auth_manager_status                      |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| 1526153517495046146 | 000000    | NULL |      NULL | wzj     | 10470c3b4b1fed12c3baac014be15fac67c6e815 | 万正军    | 万正军    | NULL   | 421023198812012155 | wzj@pidi.com | 18938831403 | 1988-12-01 12:00:00 |    1 | 1504996292152147969 | 1526111745112317954 | NULL    | 1526123139970949121 | 1526111745112317954 | 2022-05-16 18:52:08 | 1526153517495046146 | 2022-05-16 18:56:24 |      1 |          0 | 0x01                     |            1 | NULL       | 1            | 1                     | 0x00                                     |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>



<p>RDS改密码之后 ：加密值变为47ea0f61e63bfdfbe1243a17f856fe00ae820770</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from blade_user <span class="built_in">where</span> name=<span class="string">&#x27;万正军&#x27;</span>;</span></span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| id                  | tenant_id | code | user_type | account | password                                 | name      | real_name | avatar | id_card            | email          | phone       | birthday            | sex  | role_id             | dept_id             | post_id | create_user         | create_dept         | create_time         | update_user         | update_time         | status | is_deleted | auth_status              | id_card_type | id_card_no | phone_status | modify_account_status | auth_manager_status                      |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| 1526153517495046146 | 000000    | NULL |      NULL | wzj     | 47ea0f61e63bfdfbe1243a17f856fe00ae820770 | 万正军    | 万正军    | NULL   | 421023198812012155 | wzj@pidi.com | 18938831403 | 1988-12-01 12:00:00 |    1 | 1504996292152147969 | 1526111745112317954 | NULL    | 1526123139970949121 | 1526111745112317954 | 2022-05-16 18:52:08 | 1526153517495046146 | 2022-05-16 18:56:24 |      1 |          0 | 0x01                     |            1 | NULL       | 1            | 1                     | 0x00                                     |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>



<p>改密码后，自建mysql读库是否同步：也同步为47ea0f61e63bfdfbe1243a17f856fe00ae820770 了。说明同步在时时进行中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from blade_user <span class="built_in">where</span> name=<span class="string">&#x27;万正军&#x27;</span>;</span></span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| id                  | tenant_id | code | user_type | account | password                                 | name      | real_name | avatar | id_card            | email          | phone       | birthday            | sex  | role_id             | dept_id             | post_id | create_user         | create_dept         | create_time         | update_user         | update_time         | status | is_deleted | auth_status              | id_card_type | id_card_no | phone_status | modify_account_status | auth_manager_status                      |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">| 1526153517495046146 | 000000    | NULL |      NULL | wzj     | 47ea0f61e63bfdfbe1243a17f856fe00ae820770 | 万正军    | 万正军    | NULL   | 421023198812012155 | wzj@pidi.com | 18938831403 | 1988-12-01 12:00:00 |    1 | 1504996292152147969 | 1526111745112317954 | NULL    | 1526123139970949121 | 1526111745112317954 | 2022-05-16 18:52:08 | 1526153517495046146 | 2022-05-16 18:56:24 |      1 |          0 | 0x01                     |            1 | NULL       | 1            | 1                     | 0x00                                     |</span><br><span class="line">+---------------------+-----------+------+-----------+---------+------------------------------------------+-----------+-----------+--------+--------------------+----------------+-------------+---------------------+------+---------------------+---------------------+---------+---------------------+---------------------+---------------------+---------------------+---------------------+--------+------------+--------------------------+--------------+------------+--------------+-----------------------+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>



<h4 id="七、2022-10-27查到同步失败"><a href="#七、2022-10-27查到同步失败" class="headerlink" title="七、2022.10.27查到同步失败."></a>七、2022.10.27查到同步失败.</h4><p>select * from performance_schema.replication_applier_status_by_worker\G可查到哪个位置同步失败</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status \G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for source to send event</span><br><span class="line">                  Master_Host: rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: ac_repliuser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000699</span><br><span class="line">          Read_Master_Log_Pos: 71425</span><br><span class="line">               Relay_Log_File: monitoring-relay-bin.000921</span><br><span class="line">                Relay_Log_Pos: 284268</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000583</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: No</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: mysql,sys,information_schema,performance_schema</span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 1410</span><br><span class="line">                   Last_Error: Coordinator stopped because there were error(s) in the worker(s). The most recent failure being: Worker 1 failed executing transaction &#x27;8f9990ee-ce09-11ec-963f-00163e18a3de:2155158&#x27; at master log mysql-bin.000583, end_log_pos 284627. See error log and/or performance_schema.replication_applier_status_by_worker table for more details about this failure or others, if any.</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 283988</span><br><span class="line">              Relay_Log_Space: 341063670</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 1410</span><br><span class="line">               Last_SQL_Error: Coordinator stopped because there were error(s) in the worker(s). The most recent failure being: Worker 1 failed executing transaction &#x27;8f9990ee-ce09-11ec-963f-00163e18a3de:2155158&#x27; at master log mysql-bin.000583, end_log_pos 284627. See error log and/or performance_schema.replication_applier_status_by_worker table for more details about this failure or others, if any.</span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 21490876</span><br><span class="line">                  Master_UUID: 8f9990ee-ce09-11ec-963f-00163e18a3de</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: </span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: 221027 20:05:45</span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:2-27,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:456488-850920:850922-851034:851039-852407:852411-852519:852522-2740741</span><br><span class="line">            Executed_Gtid_Set: 08e6acf6-e6d2-11ec-a645-00163e18a18e:1-25,</span><br><span class="line">8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-21,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2155157</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">       Master_public_key_path: </span><br><span class="line">        Get_master_public_key: 0</span><br><span class="line">            Network_Namespace: </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from performance_schema.replication_applier_status_by_worker\G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                                           CHANNEL_NAME: </span><br><span class="line">                                              WORKER_ID: 1</span><br><span class="line">                                              THREAD_ID: NULL</span><br><span class="line">                                          SERVICE_STATE: OFF</span><br><span class="line">                                      LAST_ERROR_NUMBER: 1410</span><br><span class="line">                                     LAST_ERROR_MESSAGE: Worker 1 failed executing transaction &#x27;8f9990ee-ce09-11ec-963f-00163e18a3de:2155158&#x27; at master log mysql-bin.000583, end_log_pos 284627; Error &#x27;You are not allowed to create a user with GRANT&#x27; on query. Default database: &#x27;&#x27;. Query: &#x27;GRANT SELECT, LOCK TABLES, SHOW VIEW ON `wrp\_aciot`.* TO &#x27;user_select&#x27;@&#x27;%&#x27;&#x27;</span><br><span class="line">                                   LAST_ERROR_TIMESTAMP: 2022-10-27 20:05:45.185528</span><br><span class="line">                               LAST_APPLIED_TRANSACTION: </span><br><span class="line">     LAST_APPLIED_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">    LAST_APPLIED_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">         LAST_APPLIED_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">           LAST_APPLIED_TRANSACTION_END_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                                   APPLYING_TRANSACTION: 8f9990ee-ce09-11ec-963f-00163e18a3de:2155158</span><br><span class="line">         APPLYING_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 2022-09-29 08:54:04.695999</span><br><span class="line">        APPLYING_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 2022-09-29 08:54:04.695999</span><br><span class="line">             APPLYING_TRANSACTION_START_APPLY_TIMESTAMP: 2022-10-27 20:05:45.184016</span><br><span class="line">                 LAST_APPLIED_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">   LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">  LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                     APPLYING_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">       APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">      APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">    APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">                                           CHANNEL_NAME: </span><br><span class="line">                                              WORKER_ID: 2</span><br><span class="line">                                              THREAD_ID: NULL</span><br><span class="line">                                          SERVICE_STATE: OFF</span><br><span class="line">                                      LAST_ERROR_NUMBER: 0</span><br><span class="line">                                     LAST_ERROR_MESSAGE: </span><br><span class="line">                                   LAST_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                               LAST_APPLIED_TRANSACTION: </span><br><span class="line">     LAST_APPLIED_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">    LAST_APPLIED_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">         LAST_APPLIED_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">           LAST_APPLIED_TRANSACTION_END_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                                   APPLYING_TRANSACTION: </span><br><span class="line">         APPLYING_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">        APPLYING_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">             APPLYING_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                 LAST_APPLIED_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">   LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">  LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                     APPLYING_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">       APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">      APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">    APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">                                           CHANNEL_NAME: </span><br><span class="line">                                              WORKER_ID: 3</span><br><span class="line">                                              THREAD_ID: NULL</span><br><span class="line">                                          SERVICE_STATE: OFF</span><br><span class="line">                                      LAST_ERROR_NUMBER: 0</span><br><span class="line">                                     LAST_ERROR_MESSAGE: </span><br><span class="line">                                   LAST_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                               LAST_APPLIED_TRANSACTION: </span><br><span class="line">     LAST_APPLIED_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">    LAST_APPLIED_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">         LAST_APPLIED_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">           LAST_APPLIED_TRANSACTION_END_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                                   APPLYING_TRANSACTION: </span><br><span class="line">         APPLYING_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">        APPLYING_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">             APPLYING_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                 LAST_APPLIED_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">   LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">  LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                     APPLYING_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">       APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">      APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">    APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">                                           CHANNEL_NAME: </span><br><span class="line">                                              WORKER_ID: 4</span><br><span class="line">                                              THREAD_ID: NULL</span><br><span class="line">                                          SERVICE_STATE: OFF</span><br><span class="line">                                      LAST_ERROR_NUMBER: 0</span><br><span class="line">                                     LAST_ERROR_MESSAGE: </span><br><span class="line">                                   LAST_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                               LAST_APPLIED_TRANSACTION: </span><br><span class="line">     LAST_APPLIED_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">    LAST_APPLIED_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">         LAST_APPLIED_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">           LAST_APPLIED_TRANSACTION_END_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                                   APPLYING_TRANSACTION: </span><br><span class="line">         APPLYING_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">        APPLYING_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">             APPLYING_TRANSACTION_START_APPLY_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                 LAST_APPLIED_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">   LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">  LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">                     APPLYING_TRANSACTION_RETRIES_COUNT: 0</span><br><span class="line">       APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0</span><br><span class="line">      APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: </span><br><span class="line">    APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>查到是授权问题 </p>
<p> LAST_ERROR_NUMBER: 1410<br> LAST_ERROR_MESSAGE: Worker 1 failed executing transaction ‘8f9990ee-ce09-11ec-963f-00163e18a3de:2155158’ at master log mysql-bin.000583, end_log_pos 284627; Error ‘You are not allowed to create a user with GRANT’ on query. Default database: ‘’. Query: ‘GRANT SELECT, LOCK TABLES, SHOW VIEW ON <code>wrp\_aciot</code>.* TO ‘user_select‘@’%’’</p>
<p>看报错应该是在rds平台上创建了user_select账号，然后自建mysql没办法完成这动作。</p>
<p>当我发现未同步时已经好些天了。并且阿里云平台会过一段时间清理binlog日志。就是mysql-bin.000583已经清除掉了。我没办法跳过这个继续同步。我开始备份binlog时是mysql-bin.000595，中间差了好几个。没办法补全。只能删除所有，重新来。</p>
<h5 id="1、先在生产RDS导出所有库。"><a href="#1、先在生产RDS导出所有库。" class="headerlink" title="1、先在生产RDS导出所有库。"></a>1、先在生产RDS导出所有库。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --defaults-extra-file=/data/crond/mycli.txt -h 172.22.114.200 --databases front_wms wrp_aciot wrp_blade_cloud wrp_cangdan wrp_insurance wrp_nacos wrp_xxljob &gt; ./rdsalldb202210281627.sql</span><br></pre></td></tr></table></figure>



<h5 id="2、删除自建mysql现在的所有库"><a href="#2、删除自建mysql现在的所有库" class="headerlink" title="2、删除自建mysql现在的所有库"></a>2、删除自建mysql现在的所有库</h5><p>3、把rds所有库导入到自建mysql中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@monitoring ~]# mysql -uroot -p &lt; rdsalldb202210281627.sql </span><br><span class="line">Enter password: </span><br><span class="line">ERROR 3546 (HY000) at line 24: @@GLOBAL.GTID_PURGED cannot be changed: the added gtid set must not overlap with @@GLOBAL.GTID_EXECUTED</span><br></pre></td></tr></table></figure>

<p>导入失败。原因是之前配置过master位置. 现在导入的不对。所以需要reset master</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">reset slave;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.03 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+------------------+----------+--------------+------------------+--------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                                                                                                                    |</span><br><span class="line">+------------------+----------+--------------+------------------+--------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| mysql-bin.000005 |     1688 |              |                  | 08e6acf6-e6d2-11ec-a645-00163e18a18e:1-32,</span><br><span class="line">8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-21,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2155157 |</span><br><span class="line">+------------------+----------+--------------+------------------+--------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status;</span></span><br><span class="line">+----------------+---------------------------------------------+--------------+-------------+---------------+-----------------+---------------------+-----------------------------+---------------+-----------------------+------------------+-------------------+-----------------+-------------------------------------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+-------------+-------------------------+-----------+---------------------+-------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+</span><br><span class="line">| Slave_IO_State | Master_Host                                 | Master_User  | Master_Port | Connect_Retry | Master_Log_File | Read_Master_Log_Pos | Relay_Log_File              | Relay_Log_Pos | Relay_Master_Log_File | Slave_IO_Running | Slave_SQL_Running | Replicate_Do_DB | Replicate_Ignore_DB                             | Replicate_Do_Table | Replicate_Ignore_Table | Replicate_Wild_Do_Table | Replicate_Wild_Ignore_Table | Last_Errno | Last_Error | Skip_Counter | Exec_Master_Log_Pos | Relay_Log_Space | Until_Condition | Until_Log_File | Until_Log_Pos | Master_SSL_Allowed | Master_SSL_CA_File | Master_SSL_CA_Path | Master_SSL_Cert | Master_SSL_Cipher | Master_SSL_Key | Seconds_Behind_Master | Master_SSL_Verify_Server_Cert | Last_IO_Errno | Last_IO_Error | Last_SQL_Errno | Last_SQL_Error | Replicate_Ignore_Server_Ids | Master_Server_Id | Master_UUID | Master_Info_File        | SQL_Delay | SQL_Remaining_Delay | Slave_SQL_Running_State | Master_Retry_Count | Master_Bind | Last_IO_Error_Timestamp | Last_SQL_Error_Timestamp | Master_SSL_Crl | Master_SSL_Crlpath | Retrieved_Gtid_Set | Executed_Gtid_Set                                                                                                                    | Auto_Position | Replicate_Rewrite_DB | Channel_Name | Master_TLS_Version | Master_public_key_path | Get_master_public_key | Network_Namespace |</span><br><span class="line">+----------------+---------------------------------------------+--------------+-------------+---------------+-----------------+---------------------+-----------------------------+---------------+-----------------------+------------------+-------------------+-----------------+-------------------------------------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+-------------+-------------------------+-----------+---------------------+-------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+</span><br><span class="line">|                | rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com | ac_repliuser |        3306 |            60 |                 |                   4 | monitoring-relay-bin.000001 |             4 |                       | No               | No                |                 | mysql,sys,information_schema,performance_schema |                    |                        |                         |                             |          0 |            |            0 |                   0 |             180 | None            |                |             0 | No                 |                    |                    |                 |                   |                |                  NULL | No                            |             0 |               |              0 |                |                             |         21490876 |             | mysql.slave_master_info |         0 |                NULL |                         |              86400 |             |                         |                          |                |                    |                    | 08e6acf6-e6d2-11ec-a645-00163e18a18e:1-32,</span><br><span class="line">8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-21,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2155157 |             1 |                      |              |                    |                        |                     0 |                   |</span><br><span class="line">+----------------+---------------------------------------------+--------------+-------------+---------------+-----------------+---------------------+-----------------------------+---------------+-----------------------+------------------+-------------------+-----------------+-------------------------------------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+-------------+-------------------------+-----------+---------------------+-------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------+----------------------+--------------+--------------------+------------------------+-----------------------+-------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">reset master;</span></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line">[root@monitoring ~]# mysql -uroot -p &lt; rdsalldb202210281627.sql </span><br><span class="line">Enter password: </span><br><span class="line">[root@monitoring ~]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 61</span><br><span class="line">Server version: 8.0.29 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2022, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| front_wms          |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| wrp_aciot          |</span><br><span class="line">| wrp_blade_cloud    |</span><br><span class="line">| wrp_cangdan        |</span><br><span class="line">| wrp_insurance      |</span><br><span class="line">| wrp_nacos          |</span><br><span class="line">| wrp_xxljob         |</span><br><span class="line">+--------------------+</span><br><span class="line">11 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>7个库都导入进去了。</p>
<h5 id="3、配置-同步位置"><a href="#3、配置-同步位置" class="headerlink" title="3、配置 同步位置"></a>3、配置 同步位置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">reset slave;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SET @@GLOBAL.GTID_PURGED=<span class="string">&#x27;8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-27,</span></span></span><br><span class="line">    &#x27;&gt; 8f9990ee-ce09-11ec-963f-00163e18a3de:1-2758847&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="string">show master status \G;</span></span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mysql-bin.000001</span><br><span class="line">         Position: 157</span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-27,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2758847</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="string">show master status;</span></span></span><br><span class="line">+------------------+----------+--------------+------------------+-------------------------------------------------------------------------------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                                                                         |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------------------------------------------------------------------------------+</span><br><span class="line">| mysql-bin.000001 |      157 |              |                  | 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-27,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2758847 |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="string">start slave;</span></span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="4、查看是否同步成功"><a href="#4、查看是否同步成功" class="headerlink" title="4、查看是否同步成功"></a>4、查看是否同步成功</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status \G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for source to send event</span><br><span class="line">                  Master_Host: rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: ac_repliuser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000702</span><br><span class="line">          Read_Master_Log_Pos: 2025577</span><br><span class="line">               Relay_Log_File: monitoring-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 349581</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000702</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: mysql,sys,information_schema,performance_schema</span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 2025577</span><br><span class="line">              Relay_Log_Space: 349976</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 21490876</span><br><span class="line">                  Master_UUID: 8f9990ee-ce09-11ec-963f-00163e18a3de</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 8f9990ee-ce09-11ec-963f-00163e18a3de:2758848-2759460</span><br><span class="line">            Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-27,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2759460</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">       Master_public_key_path: </span><br><span class="line">        Get_master_public_key: 0</span><br><span class="line">            Network_Namespace: </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status \G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for source to send event</span><br><span class="line">                  Master_Host: rm-wz9037f14v67d6391.mysql.rds.aliyuncs.com</span><br><span class="line">                  Master_User: ac_repliuser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000702</span><br><span class="line">          Read_Master_Log_Pos: 2027459</span><br><span class="line">               Relay_Log_File: monitoring-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 351463</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000702</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: mysql,sys,information_schema,performance_schema</span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 2027459</span><br><span class="line">              Relay_Log_Space: 351858</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 21490876</span><br><span class="line">                  Master_UUID: 8f9990ee-ce09-11ec-963f-00163e18a3de</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 8f9990ee-ce09-11ec-963f-00163e18a3de:2758848-2759465</span><br><span class="line">            Executed_Gtid_Set: 8f4bc7e7-ce09-11ec-8d9f-00163e0ef90f:1-27,</span><br><span class="line">8f9990ee-ce09-11ec-963f-00163e18a3de:1-2759465</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">       Master_public_key_path: </span><br><span class="line">        Get_master_public_key: 0</span><br><span class="line">            Network_Namespace: </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>好了重做完成</p>
<p>以下是其他人的恢复同步办法。set @@session.gtid_next&#x3D;automatic; 可借鉴。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"> stop slave;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">set</span> @@session.gtid_next=<span class="string">&#x27;5d939d06-bd4e-11ec-a3fd-fa163e102a2d:1&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"> begin;commit;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">set</span> @@session.gtid_next=automatic;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.04 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"> show slave status\G;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


  </article>
  <!-- tag -->
  <div class="mt-12 pt-6 border-t border-gray-200">
    
  </div>
  <!-- prev and next -->
  <div class="flex justify-between mt-12 pt-6 border-t border-gray-200">
    <div>
      
        <a href="/2023/05/06/23-5%E6%9C%88%E4%BB%BD%E4%B8%8B%E6%9E%B6%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%89%E5%85%A8%E4%BA%A7%E5%93%81/" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">
          <iconify-icon width="20" icon="ri:arrow-left-s-line" data-inline="false"></iconify-icon>
          23-5月份下架阿里云安全产品
        </a>
      
    </div>
    <div>
      
        <a href="/2023/01/30/oss%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E5%8F%8A%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">
          oss域名绑定及证书更新
          <iconify-icon width="20" icon="ri:arrow-right-s-line" data-inline="false"></iconify-icon>
        </a>
      
    </div>
  </div>
  <!-- comment -->
  <div class="article-comments mt-12">
    

  </div>
</section>
<!-- js inspect -->

<script src="/lib/clipboard.min.js"></script>


<script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
  });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>



<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(document).ready(() => {
    const maraidConfig = {
      theme: "default",
      logLevel: 3,
      flowchart: { curve: "linear" },
      gantt: { axisFormat: "%m/%d/%Y" },
      sequence: { actorMargin: 50 },
    };
    mermaid.initialize(maraidConfig);
  });
</script>



<script src="/lib/fancybox/fancybox.umd.min.js"></script>

<script>
  $(document).ready(() => {
    $('.post-content').each(function(i){
      $(this).find('img').each(function(){
        if ($(this).parent().hasClass('fancybox') || $(this).parent().is('a')) return;
        var alt = this.alt;
        if (alt) $(this).after('<span class="fancybox-alt">' + alt + '</span>');
        $(this).wrap('<a class="fancybox-img" href="' + this.src + '" data-fancybox=\"gallery\" data-caption="' + alt + '"></a>')
      });
      $(this).find('.fancybox').each(function(){
        $(this).attr('rel', 'article' + i);
      });
    });

    Fancybox.bind('[data-fancybox="gallery"]', {
        // options
    })
  })
</script>

<!-- tocbot begin -->

<script src="/lib/tocbot/tocbot.min.js"></script>

<script>
  $(document).ready(() => {
      tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.post-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.post-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3',
        // For headings inside relative or absolute positioned containers within content.
        hasInnerContainers: true,
    });
  })
</script>
<!-- tocbot end -->


  </main>
  <footer class="flex flex-col h-40 items-center justify-center text-gray-400 text-sm">
  <!-- busuanzi -->
  
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- Busuanzi Analytics -->
<div class="flex items-center gap-2">
  <span>Visitors</span>
  <span id="busuanzi_value_site_uv"></span>
  <span>Page Views</span>
  <span id="busuanzi_value_site_pv"></span>
</div>
<!-- End Busuanzi Analytics -->


  <!-- copyright -->
  <div class="flex items-center gap-2">
    <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color: inherit;">CC BY-NC-SA 4.0</a>
    <span>© 2022</span>
    <iconify-icon width="18" icon="emojione-monotone:maple-leaf" ></iconify-icon>
    <a href="https://github.com/xbmlz" target="_blank" rel="noopener noreferrer">xbmlz</a>
  </div>
  <!-- powered by -->
  <div class="flex items-center gap-2">
    <span>Powered by</span>
    <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>
    <span>&</span>
    <a href="https://github.com/xbmlz/hexo-theme-maple" target="_blank" rel="noopener noreferrer">Maple</a>
  </div>

</footer>

  <div class="back-to-top box-border fixed right-6 z-1024 -bottom-20 rounded py-1 px-1 bg-slate-900 opacity-60 text-white cursor-pointer text-center dark:bg-slate-600">
    <span class="flex justify-center items-center text-sm">
      <iconify-icon width="18" icon="ion:arrow-up-c" id="go-top"></iconify-icon>
      <span id="scrollpercent"><span>0</span> %</span>
    </span>
  </div>
  
<script src="/js/main.js"></script>


  <script>
    $(document).ready(function () {
      const mapleCount = "10";
      const speed = "0.5";
      const mapleEl = document.getElementById("maple");
      const maples = Array.from({ length: mapleCount }).map(() => {
        const maple = document.createElement("div");
        const scale = Math.random() * 0.5 + 0.5;
        const offset = Math.random() * 2 - 1;
        const x = Math.random() * mapleEl.clientWidth;
        const y = -Math.random() * mapleEl.clientHeight;
        const duration = 10 / speed;
        const delay = -duration;
        maple.className = "maple";
        maple.style.width = `${24 * scale}px`;
        maple.style.height = `${24 * scale}px`;
        maple.style.left = `${x}px`;
        maple.style.top = `${y}px`;
        maple.style.setProperty("--maple-fall-offset", offset);
        maple.style.setProperty("--maple-fall-height", `${Math.abs(y) + mapleEl.clientHeight}px`);
        maple.style.animation = `fall ${duration}s linear infinite`;
        maple.style.animationDelay = `${delay}s`;
        mapleEl.appendChild(maple)
        return maple
      })
    });
  </script>
  


  <div class="fixed top-0 bottom-0 left-0 right-0 pointer-events-none print:hidden" id="maple"></div>
</body>

</html>
